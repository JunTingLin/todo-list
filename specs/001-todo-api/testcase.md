# 測試案例：具備可觀測性的 TODO API 服務

**功能**：001-todo-api
**建立日期**：2026-01-18
**測試範圍**：功能性需求測試
**參考規格**：[spec.md](spec.md)

## 測試案例組織

測試案例依據功能需求（FR）組織，每個功能需求對應一組測試案例。測試案例涵蓋：
- ✅ 正常情境（Happy Path）
- ✅ 邊界條件（Boundary Conditions）
- ✅ 錯誤情境（Error Cases）

---

## TC-001: 待辦事項管理功能

### TC-001-01: 建立待辦事項 (FR-001)

**前置條件**：
- 系統正在運行
- 無特定資料需求

**測試步驟**：
1. 發送 POST 請求至 `/todos` 端點
2. 請求 body 包含：`{"title": "購買牛奶"}`

**預期結果**：
- HTTP 狀態碼：201 Created
- 回應 body 包含：
  - `id`：唯一識別碼（非空）
  - `title`：「購買牛奶」
  - `completed`：false

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-02: 建立待辦事項（僅必填欄位）(FR-001)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 POST 請求至 `/todos` 端點
2. 請求 body 包含：`{"title": "完成報告"}`（不提供 completed 欄位）

**預期結果**：
- HTTP 狀態碼：201 Created
- 回應 body 中 `completed` 預設為 false

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-03: 建立待辦事項（缺少必填欄位）(FR-001)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 POST 請求至 `/todos` 端點
2. 請求 body 包含：`{}`（缺少 title）

**預期結果**：
- HTTP 狀態碼：400 Bad Request
- 回應包含友善的錯誤訊息，說明缺少必填欄位
- 錯誤訊息不洩漏內部實作細節

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-04: 建立待辦事項（title 為空字串）(FR-001)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 POST 請求至 `/todos` 端點
2. 請求 body 包含：`{"title": ""}`

**預期結果**：
- HTTP 狀態碼：400 Bad Request
- 回應包含友善的錯誤訊息

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-05: 唯一識別碼分配 (FR-002)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 POST 請求建立第一個待辦事項：`{"title": "任務A"}`
2. 發送 POST 請求建立第二個待辦事項：`{"title": "任務B"}`
3. 比較兩個回應中的 `id` 值

**預期結果**：
- 兩個待辦事項的 `id` 值不同
- 每個 `id` 為唯一值

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-06: 查詢所有待辦事項（有資料）(FR-003)

**前置條件**：
- 系統正在運行
- 已建立至少 2 個待辦事項

**測試步驟**：
1. 發送 GET 請求至 `/todos` 端點

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應 body 為陣列，包含所有待辦事項
- 每個待辦事項包含 `id`、`title`、`completed` 欄位

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-07: 查詢所有待辦事項（空資料）(FR-003)

**前置條件**：
- 系統正在運行
- 系統中無任何待辦事項

**測試步驟**：
1. 發送 GET 請求至 `/todos` 端點

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應 body 為空陣列 `[]`

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-08: 查詢單一待辦事項（存在的 ID）(FR-004)

**前置條件**：
- 系統正在運行
- 已建立一個待辦事項，ID 為 `{id}`

**測試步驟**：
1. 發送 GET 請求至 `/todos/{id}` 端點

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應 body 包含該待辦事項的完整資料（`id`、`title`、`completed`）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-09: 查詢單一待辦事項（不存在的 ID）(FR-004)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 GET 請求至 `/todos/99999` 端點（不存在的 ID）

**預期結果**：
- HTTP 狀態碼：404 Not Found
- 回應包含友善的錯誤訊息

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-10: 更新待辦事項標題 (FR-005)

**前置條件**：
- 系統正在運行
- 已建立一個待辦事項，ID 為 `{id}`，title 為「原始標題」

**測試步驟**：
1. 發送 PUT 請求至 `/todos/{id}` 端點
2. 請求 body 包含：`{"title": "更新後的標題"}`

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應 body 中 `title` 為「更新後的標題」
- 其他欄位（`id`、`completed`）保持不變

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-11: 更新待辦事項完成狀態 (FR-005)

**前置條件**：
- 系統正在運行
- 已建立一個待辦事項，ID 為 `{id}`，completed 為 false

**測試步驟**：
1. 發送 PUT 請求至 `/todos/{id}` 端點
2. 請求 body 包含：`{"completed": true}`

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應 body 中 `completed` 為 true
- 其他欄位（`id`、`title`）保持不變

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-12: 更新待辦事項（同時更新標題與狀態）(FR-005)

**前置條件**：
- 系統正在運行
- 已建立一個待辦事項，ID 為 `{id}`

**測試步驟**：
1. 發送 PUT 請求至 `/todos/{id}` 端點
2. 請求 body 包含：`{"title": "新標題", "completed": true}`

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應 body 中 `title` 為「新標題」，`completed` 為 true

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-13: 更新待辦事項（不存在的 ID）(FR-005)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 PUT 請求至 `/todos/99999` 端點（不存在的 ID）
2. 請求 body 包含：`{"title": "新標題"}`

**預期結果**：
- HTTP 狀態碼：404 Not Found
- 回應包含友善的錯誤訊息

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-14: 刪除待辦事項 (FR-006)

**前置條件**：
- 系統正在運行
- 已建立一個待辦事項，ID 為 `{id}`

**測試步驟**：
1. 發送 DELETE 請求至 `/todos/{id}` 端點
2. 發送 GET 請求至 `/todos/{id}` 端點驗證刪除結果

**預期結果**：
- DELETE 請求：HTTP 狀態碼 204 No Content
- GET 請求：HTTP 狀態碼 404 Not Found（該待辦事項已不存在）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-15: 刪除待辦事項（不存在的 ID）(FR-006)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 DELETE 請求至 `/todos/99999` 端點（不存在的 ID）

**預期結果**：
- HTTP 狀態碼：404 Not Found
- 回應包含友善的錯誤訊息

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-001-16: 記憶體儲存驗證 (FR-007)

**前置條件**：
- 系統正在運行
- 已建立至少 1 個待辦事項

**測試步驟**：
1. 記錄當前待辦事項的 ID
2. 重啟系統
3. 發送 GET 請求至 `/todos/{id}` 端點

**預期結果**：
- HTTP 狀態碼：404 Not Found（資料已遺失）
- 或 GET `/todos` 回傳空陣列

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

## TC-002: 請求追蹤與日誌功能

### TC-002-01: 基本日誌記錄 (FR-008)

**前置條件**：
- 系統正在運行
- 能夠存取系統日誌輸出（stdout）

**測試步驟**：
1. 發送 GET 請求至 `/todos` 端點
2. 檢查系統日誌輸出

**預期結果**：
- 日誌為 JSON 格式（結構化）
- 日誌包含以下欄位：
  - `request_id`：非空
  - `timestamp`：ISO 8601 格式
  - `method`：「GET」
  - `path`：「/todos」
  - `status_code`：200
  - `latency_ms`：數值（毫秒）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-002-02: 使用者提供 request_id (FR-009, FR-011)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 GET 請求至 `/todos` 端點
2. 請求標頭包含：`X-Request-ID: test-request-123`
3. 檢查回應標頭與系統日誌

**預期結果**：
- 回應標頭包含：`X-Request-ID: test-request-123`
- 系統日誌中的 `request_id` 為「test-request-123」

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-002-03: 系統自動產生 request_id (FR-010, FR-011)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 GET 請求至 `/todos` 端點（不提供 X-Request-ID 標頭）
2. 檢查回應標頭與系統日誌

**預期結果**：
- 回應標頭包含：`X-Request-ID: {自動產生的 UUID}`
- 系統日誌中的 `request_id` 與回應標頭中的值一致
- `request_id` 格式為 UUID

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-002-04: 日誌格式為 JSON (FR-012)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送任意 API 請求
2. 擷取日誌輸出
3. 嘗試將日誌解析為 JSON

**預期結果**：
- 日誌可成功解析為有效的 JSON 物件
- JSON 包含所有必要欄位（request_id、timestamp、method、path、status_code、latency_ms）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-002-05: 日誌不包含敏感資訊 (FR-013)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送多個不同類型的 API 請求（POST、GET、PUT、DELETE）
2. 檢查所有日誌輸出

**預期結果**：
- 日誌中不包含任何敏感資訊（密碼、權杖、個人識別資訊等）
- 即使未來擴充驗證功能，也不應洩漏敏感資料

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

## TC-003: 錯誤處理

### TC-003-01: 錯誤日誌記錄 (FR-014)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送會導致錯誤的請求（例如：GET `/todos/invalid-id`）
2. 檢查系統日誌

**預期結果**：
- 日誌中記錄錯誤資訊
- 錯誤日誌包含 `error` 欄位，描述錯誤詳情
- 錯誤日誌包含完整的請求上下文（request_id、path、method 等）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-003-02: 友善的錯誤訊息 (FR-015)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 POST 請求至 `/todos`，body 為空（缺少必填欄位）
2. 檢查回應訊息

**預期結果**：
- 錯誤訊息使用友善的語言（繁體中文或英文）
- 錯誤訊息不包含：
  - 程式碼堆疊追蹤（stack trace）
  - 內部變數名稱
  - 資料庫錯誤訊息
  - 框架/函式庫的技術細節

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-003-03: 適當的 HTTP 狀態碼 - 400 (FR-016)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送格式錯誤的請求（例如：POST `/todos` 缺少 title）

**預期結果**：
- HTTP 狀態碼：400 Bad Request

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-003-04: 適當的 HTTP 狀態碼 - 404 (FR-016)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送請求至不存在的資源（例如：GET `/todos/99999`）

**預期結果**：
- HTTP 狀態碼：404 Not Found

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-003-05: 適當的 HTTP 狀態碼 - 500 (FR-016)

**前置條件**：
- 系統正在運行
- 能夠觸發內部伺服器錯誤（例如：模擬系統故障）

**測試步驟**：
1. 觸發內部伺服器錯誤

**預期結果**：
- HTTP 狀態碼：500 Internal Server Error
- 錯誤訊息友善且不洩漏內部細節

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

## TC-004: 健康檢查與指標

### TC-004-01: 健康檢查端點 (FR-017)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 GET 請求至 `/health` 端點（或類似的健康檢查端點）

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應包含服務健康狀態資訊（例如：`{"status": "healthy"}`）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-004-02: 請求次數指標 (FR-018)

**前置條件**：
- 系統正在運行
- 已發送至少 5 次 API 請求

**測試步驟**：
1. 發送 GET 請求至 `/metrics` 端點（或類似的指標端點）
2. 檢查回應中的請求次數指標

**預期結果**：
- 回應包含請求總次數指標
- 指標值 ≥ 5（至少包含前置條件中的 5 次請求）
- 指標可按端點分組（例如：`/todos` 的請求次數）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-004-03: 延遲指標 (FR-019)

**前置條件**：
- 系統正在運行
- 已發送多次 API 請求

**測試步驟**：
1. 發送 GET 請求至 `/metrics` 端點
2. 檢查回應中的延遲指標

**預期結果**：
- 回應包含延遲指標，包括：
  - 最小延遲
  - 最大延遲
  - 平均延遲
  - 或延遲分布（直方圖、百分位數）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-004-04: 避免高基數標籤 (FR-020)

**前置條件**：
- 系統正在運行
- 已發送多次 API 請求（使用不同的 request_id）

**測試步驟**：
1. 發送 GET 請求至 `/metrics` 端點
2. 檢查指標的標籤（labels）

**預期結果**：
- 指標標籤不包含高基數值，例如：
  - ❌ 不包含個別的 request_id
  - ❌ 不包含個別的使用者 ID
  - ✅ 可包含端點路徑（如 `/todos`）
  - ✅ 可包含 HTTP 方法（如 `GET`、`POST`）
  - ✅ 可包含狀態碼（如 `200`、`404`）

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-004-05: 指標端點可被外部系統擷取 (FR-021)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 使用外部 HTTP 客戶端（如 curl、Postman）發送 GET 請求至 `/metrics` 端點
2. 檢查回應格式

**預期結果**：
- HTTP 狀態碼：200 OK
- 回應格式為標準指標格式（Prometheus 或 OpenMetrics 格式）
- 外部監控系統可成功解析指標資料

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

## TC-005: 非功能約束

### TC-005-01: 無驗證機制驗證 (FR-022)

**前置條件**：
- 系統正在運行

**測試步驟**：
1. 發送 API 請求（任意端點）不提供任何驗證資訊（無 token、無 session）

**預期結果**：
- 請求成功處理（根據請求類型回應適當的狀態碼）
- 系統不要求驗證或授權

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

### TC-005-02: 獨立啟動驗證 (FR-023)

**前置條件**：
- 系統未啟動
- 無外部依賴（資料庫、快取等）運行

**測試步驟**：
1. 啟動系統
2. 發送 GET 請求至 `/health` 端點

**預期結果**：
- 系統成功啟動，無需外部依賴
- `/health` 端點回應 200 OK
- 系統可正常接受與處理請求

**實際結果**：_（執行後填寫）_

**狀態**：⬜ 未執行 / ⬜ 通過 / ⬜ 失敗

---

## 測試執行摘要

**總測試案例數**：35
**已執行**：0
**通過**：0
**失敗**：0
**未執行**：35

### 測試案例分布

| 功能模組 | 測試案例數 |
|---------|-----------|
| TC-001: 待辦事項管理功能 | 16 |
| TC-002: 請求追蹤與日誌功能 | 5 |
| TC-003: 錯誤處理 | 5 |
| TC-004: 健康檢查與指標 | 5 |
| TC-005: 非功能約束 | 2 |

### 測試覆蓋率

| 功能需求 | 測試案例 | 覆蓋狀態 |
|---------|---------|---------|
| FR-001 | TC-001-01 ~ TC-001-04 | ✅ 已覆蓋 |
| FR-002 | TC-001-05 | ✅ 已覆蓋 |
| FR-003 | TC-001-06 ~ TC-001-07 | ✅ 已覆蓋 |
| FR-004 | TC-001-08 ~ TC-001-09 | ✅ 已覆蓋 |
| FR-005 | TC-001-10 ~ TC-001-13 | ✅ 已覆蓋 |
| FR-006 | TC-001-14 ~ TC-001-15 | ✅ 已覆蓋 |
| FR-007 | TC-001-16 | ✅ 已覆蓋 |
| FR-008 | TC-002-01 | ✅ 已覆蓋 |
| FR-009 | TC-002-02 | ✅ 已覆蓋 |
| FR-010 | TC-002-03 | ✅ 已覆蓋 |
| FR-011 | TC-002-02 ~ TC-002-03 | ✅ 已覆蓋 |
| FR-012 | TC-002-04 | ✅ 已覆蓋 |
| FR-013 | TC-002-05 | ✅ 已覆蓋 |
| FR-014 | TC-003-01 | ✅ 已覆蓋 |
| FR-015 | TC-003-02 | ✅ 已覆蓋 |
| FR-016 | TC-003-03 ~ TC-003-05 | ✅ 已覆蓋 |
| FR-017 | TC-004-01 | ✅ 已覆蓋 |
| FR-018 | TC-004-02 | ✅ 已覆蓋 |
| FR-019 | TC-004-03 | ✅ 已覆蓋 |
| FR-020 | TC-004-04 | ✅ 已覆蓋 |
| FR-021 | TC-004-05 | ✅ 已覆蓋 |
| FR-022 | TC-005-01 | ✅ 已覆蓋 |
| FR-023 | TC-005-02 | ✅ 已覆蓋 |

**功能需求覆蓋率**：23/23 (100%)

---

## 測試執行指南

### 測試環境準備

1. 確保系統已正確部署並可啟動
2. 準備 HTTP 客戶端工具（curl、Postman、HTTPie 等）
3. 確保能夠存取系統日誌輸出（stdout）
4. 準備測試資料記錄表單

### 測試執行順序建議

1. **基礎功能測試**：先執行 TC-005-02（獨立啟動）確保系統可運行
2. **CRUD 測試**：執行 TC-001 系列，驗證核心待辦事項管理功能
3. **可觀測性測試**：執行 TC-002 系列，驗證日誌與追蹤功能
4. **錯誤處理測試**：執行 TC-003 系列，驗證錯誤情境處理
5. **監控功能測試**：執行 TC-004 系列，驗證健康檢查與指標

### 測試記錄

- 每個測試案例執行後填寫「實際結果」與「狀態」
- 失敗的測試案例需記錄：
  - 失敗原因
  - 錯誤訊息
  - 重現步驟
  - 相關截圖或日誌

### 測試通過標準

- 所有測試案例狀態為「通過」
- 功能需求覆蓋率達 100%
- 無未解決的嚴重缺陷

---

## 備註

- 本測試案例文件專注於功能性需求測試
- 非功能性需求（如效能、並發、安全性）的詳細測試可另外規劃
- 測試案例應與 spec.md 保持同步，當規格變更時需更新測試案例
- 建議使用自動化測試工具（如契約測試框架）執行這些測試案例
